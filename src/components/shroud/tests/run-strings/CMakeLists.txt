#
# run-strings - A test program to use the strings examples
#

include_directories(.)  # needed by ../strings files

add_executable( shroud-run-strings
    main.f

    # The 'library' to wrap
    strings.cpp

    # Files generated by shroud
    ../strings/wrapfstrings.f
    ../strings/wrapstrings.cpp
)
target_link_libraries(shroud-run-strings fruit shroudrt)
set_target_properties(shroud-run-strings PROPERTIES
   LINKER_LANGUAGE Fortran
   RUNTIME_OUTPUT_DIRECTORY ${TEST_OUTPUT_DIRECTORY}
)
add_test( NAME shroud-run-strings
          COMMAND shroud-run-strings
          WORKING_DIRECTORY ${TEST_OUTPUT_DIRECTORY}
)

#add_fortran_test(
#    TEST_SOURCE ${test}
#    DEPENDS_ON fruit
#)


#
# Make Python module library
#
if(ENABLE_PYTHON_API)
    include_directories(${PYTHON_INCLUDE_DIRS})

    set(BUILD_SHARED_LIBS TRUE)
    make_library(
        LIBRARY_NAME
            strings
        LIBRARY_SOURCES
            strings.cpp
            # Files generated by shroud
            ../strings/pyClass1type.cpp
            ../strings/pyStringsmodule.cpp
            ../strings/pyStringshelper.cpp
        DEPENDS_ON
            shroudrt
    )

    # Python wants the name to be strings.so
    set_target_properties(strings
        PROPERTIES
          PREFIX ""
    )

#    add_custom_command(
#        TARGET strings POST_BUILD
#        WORKING_DIRECTORY ${LIBRARY_OUTPUT_PATH}
#        COMMAND ln -sf libstrings.so strings.so
#    )

endif(ENABLE_PYTHON_API)
